---
name: Game Loop Validation (End-to-End Playtest)
status: open
created: 2026-02-09T01:33:04Z
updated: 2026-02-09T01:37:45Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/73
depends_on: [67, 68, 69, 70, 71, 72]
parallel: false
conflicts_with: []
---

# Task: Game Loop Validation (End-to-End Playtest)

## Description

Conduct a comprehensive end-to-end playtest of the complete DM system, covering exploration, social interaction, and basic combat. Document every friction point, fix critical issues found, and produce a validated "it works" proof.

This is the final task — it validates that all previous tasks integrate correctly.

## Acceptance Criteria

### Session Lifecycle
- [ ] `/dm:start` successfully loads a campaign and sets an opening scene
- [ ] DM persona activates and Claude speaks as the DM
- [ ] `/dm:save` saves all state and provides session summary
- [ ] `/dm:start` with existing session resumes correctly with recap

### Exploration
- [ ] Player describes movement: "I walk to the tavern" → DM describes the tavern
- [ ] Player searches: "I search the room" → DM calls for Perception check → narrates result
- [ ] Player examines: "I look at the painting" → DM provides detail
- [ ] Game state updates: location changes reflected in `get_game_state`

### Social Interaction
- [ ] Player talks to NPC: "I ask the innkeeper about rumors" → DM roleplays NPC
- [ ] NPC has distinct voice matching their personality from `get_npc`
- [ ] Player persuades: "I try to convince the guard to let us pass" → DM calls for Persuasion check
- [ ] NPC interaction logged via `add_event`

### Basic Combat
- [ ] Combat initiated: "I attack the goblin" or DM triggers encounter
- [ ] Initiative rolled for all participants
- [ ] Turn order managed correctly
- [ ] Player attack: roll to hit → roll damage → HP updated
- [ ] Enemy turn: DM decides action → resolves → narrates
- [ ] Combat ends: aftermath narration, XP/loot
- [ ] Character HP changes persisted

### DM Behavior
- [ ] DM never asks player to make DM decisions
- [ ] DM uses tools proactively (rolls dice without being asked)
- [ ] DM maintains consistent narrative tone throughout session
- [ ] DM resolves ambiguous situations autonomously

### State Persistence
- [ ] Save session mid-play
- [ ] Resume session — all state recovered (HP, location, quest progress)
- [ ] NPC interactions remembered within session
- [ ] Events logged to adventure log

## Technical Details

### Playtest Script
Run through this scenario sequentially:

1. **Setup:** Create a test campaign "Playtest Valley" with a level 1 Fighter character, an innkeeper NPC, a tavern location, and a quest
2. **Start:** `/dm:start Playtest Valley`
3. **Explore:** Describe the tavern, look around, search for something
4. **Social:** Talk to innkeeper, ask about a quest, try to negotiate payment
5. **Travel:** Move to a different location
6. **Combat trigger:** Encounter goblins on the road
7. **Combat:** Full combat: initiative → player attacks → enemies attack → resolution
8. **Aftermath:** Loot, XP, return to tavern
9. **Save:** `/dm:save`
10. **Resume:** `/dm:start Playtest Valley` — verify recap and state

### Issue Tracking
For each friction point found:
- Document the issue (what happened, what was expected)
- Classify: Critical (blocks gameplay) / High (degrades experience) / Low (cosmetic)
- Fix critical issues immediately
- Log high/low issues as follow-up work

### Test Data Creation
Use existing MCP tools to create test data:
```
create_campaign → "Playtest Valley"
create_character → Level 1 Human Fighter "Aldric"
create_npc → "Berta" (innkeeper, friendly)
create_location → "The Rusty Tankard" (tavern)
create_quest → "Clear the Road" (eliminate goblins)
```

## Dependencies
- [ ] Task 67 (Tool Output Audit) — enriched tool data
- [ ] Task 68 (Session Tool Fixes) — working session lifecycle
- [ ] Task 69 (DM Persona File) — DM behavior instructions
- [ ] Task 70 (Specialist Sub-Agents) — narrator, combat, rules agents
- [ ] Task 71 (Game Skills) — /dm:start, /dm:action, /dm:combat, /dm:save
- [ ] Task 72 (Hybrid Python Integration) — intent classification wired in

## Effort Estimate
- Size: M
- Hours: 4-6
- Parallel: false — final integration task, depends on all others
- Conflicts: none

## Definition of Done
- [ ] Complete playtest scenario executed successfully
- [ ] Exploration, social, and combat all functional
- [ ] Session save/resume works
- [ ] DM behavior meets autonomy criteria (zero player-as-DM moments)
- [ ] Critical issues fixed
- [ ] Playtest report documenting results and remaining issues
