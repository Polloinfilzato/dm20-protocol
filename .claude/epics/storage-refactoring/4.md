---
name: Add legacy detection and backward compatibility
status: open
created: 2026-02-01T23:51:23Z
updated: 2026-02-01T23:51:23Z
github: https://github.com/Polloinfilzato/gamemaster-mcp/issues/3
updated: 2026-02-02T00:06:07Z
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Add legacy detection and backward compatibility

## Description

Implement automatic detection of campaign storage format (monolithic vs split) and ensure existing monolithic campaigns continue to work without any changes.

## Acceptance Criteria

- [ ] Detect if campaign exists as file (`campaigns/{name}.json`) or directory (`campaigns/{name}/`)
- [ ] Load monolithic campaigns using existing logic
- [ ] Load split campaigns using new `SplitStorageBackend`
- [ ] New campaigns always use split structure
- [ ] Existing tool behavior unchanged for monolithic campaigns
- [ ] No data loss during format detection

## Technical Details

**Detection Logic:**
```python
def _detect_campaign_format(self, campaign_name: str) -> str:
    """Returns 'monolithic' or 'split'"""
    dir_path = self.data_dir / "campaigns" / campaign_name
    file_path = self.data_dir / "campaigns" / f"{campaign_name}.json"

    if dir_path.is_dir():
        return "split"
    elif file_path.is_file():
        return "monolithic"
    else:
        return "not_found"
```

**Files affected:**
- `src/gamemaster_mcp/storage.py`

## Dependencies

- [ ] None (can be developed in parallel with Task 3)

## Effort Estimate

- Size: S
- Hours: 2-3
- Parallel: true

## Definition of Done

- [ ] Detection logic implemented
- [ ] Existing monolithic campaigns load correctly
- [ ] Tests for both formats
