---
name: Migrate storage.py to use split storage
status: open
created: 2026-02-01T23:51:23Z
updated: 2026-02-01T23:51:23Z
github: https://github.com/Polloinfilzato/gamemaster-mcp/issues/4
updated: 2026-02-02T00:06:07Z
depends_on: [3, 4]
parallel: false
conflicts_with: []
---

# Task: Migrate storage.py to use split storage

## Description

Integrate the split storage backend into the main `CampaignStorage` class. New campaigns should automatically use split storage, while existing campaigns continue to use their current format.

## Acceptance Criteria

- [ ] `create_campaign()` creates directory structure with split files
- [ ] `_save_campaign()` uses split backend for split campaigns
- [ ] `_load_current_campaign()` loads from correct format based on detection
- [ ] All existing methods (`add_character`, `update_character`, etc.) work with split storage
- [ ] Character index rebuilding works with split storage
- [ ] Batch mode works with split storage

## Technical Details

**Key Integration Points:**
- `create_campaign()` → create directory + initial files
- `_save_campaign()` → delegate to split backend if split format
- `_load_current_campaign()` → detect format and load accordingly
- All entity methods → work through unified interface

**Files affected:**
- `src/gamemaster_mcp/storage.py`

## Dependencies

- [ ] Task 3: Implement split storage backend
- [ ] Task 4: Add legacy detection and backward compatibility

## Effort Estimate

- Size: M
- Hours: 4-6
- Parallel: false (depends on Tasks 3 and 4)

## Definition of Done

- [ ] New campaigns use split storage
- [ ] Existing campaigns continue to work
- [ ] All CRUD operations work with both formats
- [ ] Integration tests passing
