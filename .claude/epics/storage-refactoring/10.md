---
name: Write comprehensive tests
status: open
created: 2026-02-01T23:51:23Z
updated: 2026-02-01T23:51:23Z
github: https://github.com/Polloinfilzato/gamemaster-mcp/issues/9
updated: 2026-02-02T00:06:07Z
depends_on: [5, 7, 8]
parallel: false
conflicts_with: []
---

# Task: Write comprehensive tests

## Description

Write comprehensive unit and integration tests for split storage, TOON output, and session summarizer functionality to achieve ≥80% test coverage.

## Acceptance Criteria

- [ ] Unit tests for `SplitStorageBackend` class
- [ ] Unit tests for dirty tracking mechanism
- [ ] Unit tests for legacy detection
- [ ] Unit tests for TOON encoder with fallback
- [ ] Integration tests for format parameter on list tools
- [ ] Integration tests for `summarize_session` tool
- [ ] Integration tests for migration utility
- [ ] Test backward compatibility with monolithic campaigns
- [ ] Achieve ≥80% code coverage for new code

## Technical Details

**Test files to create/update:**
- `tests/test_split_storage.py` (new)
- `tests/test_toon_encoder.py` (new)
- `tests/test_session_summarizer.py` (new)
- `tests/test_storage.py` (update existing)
- `tests/test_main.py` (update existing)

**Test scenarios:**
1. **Split Storage:**
   - Create new campaign with split structure
   - Load existing split campaign
   - Save only dirty sections
   - Verify atomic writes

2. **Legacy Detection:**
   - Detect monolithic format
   - Detect split format
   - Handle non-existent campaign

3. **TOON Encoder:**
   - Encode to TOON format
   - Fallback to JSON on error
   - Handle missing library

4. **Session Summarizer:**
   - Process normal transcription
   - Handle large transcription (chunking)
   - Apply speaker mapping

**Files affected:**
- `tests/` directory

## Dependencies

- [ ] Task 5: Migrate storage.py
- [ ] Task 7: Add format parameter
- [ ] Task 8: Implement summarize_session

## Effort Estimate

- Size: M
- Hours: 6-8
- Parallel: false (depends on all feature tasks)

## Definition of Done

- [ ] All tests passing
- [ ] ≥80% coverage for new code
- [ ] CI pipeline green
