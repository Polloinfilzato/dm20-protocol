---
name: Add migration utility script
status: completed
created: 2026-02-01T23:51:23Z
updated: 2026-02-02T11:45:00Z
github: https://github.com/Polloinfilzato/gamemaster-mcp/issues/8
depends_on: [5]
parallel: true
conflicts_with: []
completed: 2026-02-02T11:45:00Z
---

# Task: Add migration utility script

## Description

Create an optional migration utility that allows users to convert existing monolithic campaign files to the new split directory structure.

## Acceptance Criteria

- [x] Create `scripts/migrate_campaign.py` utility
- [x] Accept campaign name as argument
- [x] Read monolithic JSON file
- [x] Create split directory structure
- [x] Write separate files for each section
- [x] Optionally backup original file
- [x] Provide dry-run mode to preview changes
- [x] Document usage in README

## Technical Details

**Script usage:**
```bash
python scripts/migrate_campaign.py "Campaign Name" --backup --dry-run
```

**Options:**
- `--backup`: Keep original file as `.json.bak`
- `--dry-run`: Show what would be done without making changes
- `--force`: Overwrite existing split directory

**Migration steps:**
1. Load monolithic `campaigns/{name}.json`
2. Create `campaigns/{name}/` directory
3. Extract and write each section to separate file
4. Migrate sessions to individual files
5. Optionally remove/backup original file

**Files affected:**
- `scripts/migrate_campaign.py` (new)
- `README.md` (documentation)

## Dependencies

- [ ] Task 5: Migrate storage.py to use split storage

## Effort Estimate

- Size: S
- Hours: 3-4
- Parallel: true (once Task 5 is done)

## Definition of Done

- [x] Script implemented
- [x] Backup functionality working
- [x] Dry-run mode working
- [x] Usage documented

## Implementation Summary

Successfully implemented comprehensive migration utility with the following features:

**Core Functionality:**
- Complete CampaignMigrator class with atomic writes and rollback
- Validation of inputs before making changes
- SHA-256 hash computation for data verification
- Sanitization of campaign names for filesystem compatibility

**Command-Line Interface:**
- Full argparse implementation with all required options
- Help text and usage examples
- Support for custom data directories

**Safety Features:**
- Atomic file writes (write to temp, then rename)
- Automatic rollback on errors
- Dry-run mode for safe preview
- Backup option to preserve original files
- Force option for overwriting existing directories

**Testing:**
- 16 comprehensive test cases covering all functionality
- Tests for sanitization, hashing, validation, and migration
- Edge cases for invalid JSON, missing fields, and permissions
- 100% test pass rate

**Documentation:**
- Updated main README.md with migration section
- Created detailed scripts/README.md with:
  - Quick start guide
  - Usage examples (basic and advanced)
  - Complete options reference
  - Troubleshooting guide
  - Best practices

**Commits:**
1. c6a3999 - Migration script implementation
2. bfdddba - Comprehensive test suite (16 tests)
3. f82b3da - Detailed documentation

All code follows Python best practices with type hints, comprehensive docstrings,
and clean error handling. Script is production-ready and well-tested.
