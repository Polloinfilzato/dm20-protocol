---
name: Implement summarize_session tool
status: open
created: 2026-02-01T23:51:23Z
updated: 2026-02-01T23:51:23Z
github: https://github.com/Polloinfilzato/gamemaster-mcp/issues/7
updated: 2026-02-02T00:06:07Z
depends_on: [5, 7]
parallel: false
conflicts_with: []
---

# Task: Implement summarize_session tool

## Description

Create a new MCP tool `summarize_session` that accepts a game session transcription and generates a structured `SessionNote` with events, NPC encounters, quest updates, and other relevant information.

## Acceptance Criteria

- [ ] Accept `transcription: str` parameter (raw text or file path)
- [ ] Accept `session_number: int` parameter
- [ ] Accept `detail_level: str` parameter ("brief", "medium", "detailed")
- [ ] Accept optional `speaker_map: dict[str, str]` for speaker label mapping
- [ ] Load campaign context (characters, quests, locations) for reference
- [ ] Filter irrelevant content (off-topic chatter, breaks)
- [ ] Extract roleplay-significant events
- [ ] Generate structured `SessionNote` output
- [ ] Save to `sessions/session-{NNN}.json`
- [ ] Handle Italian language transcriptions
- [ ] Implement chunking for large transcriptions (>50k tokens)

## Technical Details

**New tool in `main.py`:**
```python
@server.tool()
async def summarize_session(
    transcription: str,
    session_number: int,
    detail_level: str = "medium",
    speaker_map: dict[str, str] | None = None
) -> str:
    ...
```

**Output structure (SessionNote):**
```json
{
  "session_number": 5,
  "title": "The Letter Revealed",
  "date": "2026-02-02T20:00:00Z",
  "summary": "Brief summary...",
  "events": ["Event 1", "Event 2"],
  "characters_present": ["Aldric", "Bramble"],
  "npcs_encountered": ["Rollo Goodbody"],
  "quest_updates": {"Quest Name": "Progress"},
  "combat_encounters": [],
  "loot_found": [],
  "experience_gained": 150,
  "notes": "DM notes"
}
```

**Chunking strategy:**
- If transcription > 50k tokens, split into chunks
- Process each chunk to extract events
- Merge results with deduplication

**Files affected:**
- `src/gamemaster_mcp/main.py`
- `src/gamemaster_mcp/models.py` (if SessionNote needs updates)

## Dependencies

- [ ] Task 5: Migrate storage.py to use split storage (for sessions/ directory)
- [ ] Task 7: Add format parameter to list tools (for TOON context loading)

## Effort Estimate

- Size: L
- Hours: 8-10
- Parallel: false (depends on Tasks 5 and 7)

## Definition of Done

- [ ] Tool implemented and registered
- [ ] Italian transcriptions handled
- [ ] Chunking for large transcriptions working
- [ ] Session saved to correct location
- [ ] Integration tests passing
