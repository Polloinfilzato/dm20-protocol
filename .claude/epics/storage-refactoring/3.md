---
name: Implement split storage backend
status: completed
created: 2026-02-01T23:51:23Z
updated: 2026-02-01T23:51:23Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/2
updated: 2026-02-02T00:06:07Z
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Implement split storage backend

## Description

Create a new `SplitStorageBackend` class that manages campaign data as separate JSON files instead of a single monolithic file. This includes per-file save/load methods and dirty tracking per section.

## Acceptance Criteria

- [ ] Create `SplitStorageBackend` class in `storage.py`
- [ ] Implement directory structure creation for new campaigns
- [ ] Implement per-file save methods: `_save_characters()`, `_save_npcs()`, `_save_locations()`, `_save_quests()`, `_save_encounters()`, `_save_game_state()`, `_save_campaign_metadata()`
- [ ] Implement per-file load methods for each section
- [ ] Implement `sessions/` subdirectory with individual session files
- [ ] Add per-section dirty tracking using hashes (replace single `_campaign_hash`)
- [ ] Only write files that have been modified (dirty tracking)
- [ ] Maintain atomic writes (write to temp file, then rename)

## Technical Details

**Directory Structure:**
```
data/campaigns/{campaign-name}/
├── campaign.json      # Metadata only
├── characters.json
├── npcs.json
├── locations.json
├── quests.json
├── encounters.json
├── game_state.json
└── sessions/
    └── session-{NNN}.json
```

**Dirty Tracking:**
```python
_section_hashes: dict[str, str] = {
    "characters": "",
    "npcs": "",
    "locations": "",
    # etc.
}
```

**Files affected:**
- `src/gamemaster_mcp/storage.py`

## Dependencies

- [ ] None (foundation task)

## Effort Estimate

- Size: M
- Hours: 6-8
- Parallel: true

## Definition of Done

- [ ] Code implemented
- [ ] All per-file save/load methods working
- [ ] Dirty tracking prevents unnecessary writes
- [ ] Unit tests passing
