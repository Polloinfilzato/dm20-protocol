---
name: Player Web UI
status: completed
created: 2026-02-17T16:54:33Z
updated: 2026-02-17T17:07:59Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/153
depends_on: [149]
parallel: true
conflicts_with: []
---

# Task: Player Web UI

## Description

Build the responsive browser interface that players see when they scan their QR code. The UI is a single HTML page with vanilla CSS and JavaScript — no framework, no build step, no Node.js dependency.

The interface is mobile-first (primary device is a smartphone) and includes: narrative feed, private DM messages, character summary, action input, and status indicators.

## Acceptance Criteria

- [ ] Single `index.html` page served at `GET /play?token=xxx`
- [ ] Mobile-first responsive design: works on iPhone SE (375px) through desktop (1920px)
- [ ] **Narrative feed**: scrollable area showing game narrative, auto-scrolls to newest message
- [ ] **Private messages section**: collapsible, visually distinct (different background), shows DM whispers
- [ ] **Character summary bar**: sticky header with character name, HP (current/max), AC, level, active conditions
- [ ] **Full character sheet**: expandable panel with ability scores, skills, inventory, spell slots, features (read-only)
- [ ] **Action input**: fixed bottom bar with text input + send button, mobile keyboard friendly
- [ ] **Action status**: visual indicator showing queued → processing → done for submitted actions
- [ ] **Connection status**: indicator showing connected/disconnected/reconnecting
- [ ] WebSocket client connects on page load, handles messages, auto-reconnects on disconnect
- [ ] Fetches character data from `GET /character/{player_id}` on load and on update events
- [ ] Fetches narrative history on initial load (last N responses)
- [ ] Dark theme by default (easier on eyes for long sessions)
- [ ] No external CDN dependencies — all assets self-contained
- [ ] Touch-friendly: buttons ≥ 44px tap targets, no hover-dependent interactions
- [ ] Works on iOS Safari, Android Chrome, Firefox, desktop Chrome/Safari/Firefox

## Technical Details

### Files

```
src/dm20_protocol/party/static/
├── index.html          # Main page structure
├── style.css           # Mobile-first responsive styles, dark theme
└── app.js              # WebSocket client, DOM updates, action submission, character fetch
```

### HTML Structure

```html
<body>
  <header class="character-bar">
    <!-- Sticky: Name, HP, AC, Level, Conditions -->
    <!-- Tap to expand full character sheet -->
  </header>

  <main class="game-area">
    <section class="narrative-feed">
      <!-- Scrollable: narrative messages, auto-scroll -->
    </section>

    <section class="private-messages" collapsible>
      <!-- DM whispers, hidden rolls, secrets -->
    </section>

    <section class="character-sheet" expandable hidden>
      <!-- Full sheet: abilities, skills, inventory, spells, features -->
    </section>
  </main>

  <footer class="action-bar">
    <!-- Fixed bottom: text input + send button + status indicator -->
  </footer>
</body>
```

### JavaScript (`app.js`)

Key responsibilities:
- **WebSocket client**: connect to `ws://host:port/ws`, send token as first message, handle incoming messages
- **Message handler**: parse incoming WebSocket messages, route to correct UI section (narrative / private / character update / combat state)
- **Action submission**: POST to `/action` with token and text, show status indicator
- **Character fetch**: GET `/character/{player_id}` on load and on `character_updated` WebSocket events
- **Auto-reconnect**: on WebSocket close, retry with exponential backoff (1s, 2s, 4s, max 30s)
- **Narrative history**: on connect, request last N messages to populate the feed

### CSS (`style.css`)

- Dark theme: `#1a1a2e` background, `#e0e0e0` text, accent colors for different message types
- Mobile-first: base styles for 375px, `@media (min-width: 768px)` for tablet/desktop
- Narrative messages: distinct styling for public narrative, private messages (gold border), combat (red border)
- Character bar: `position: sticky; top: 0`
- Action bar: `position: fixed; bottom: 0` with padding for mobile safe areas (`env(safe-area-inset-bottom)`)
- Smooth animations for expanding/collapsing sections
- HP bar: colored gradient (green → yellow → red as HP decreases)

### Message Types (WebSocket)

```javascript
// Incoming from server:
{ type: "narrative", content: "...", timestamp: "..." }
{ type: "private", content: "...", from: "DM", timestamp: "..." }
{ type: "character_update", data: { hp: 45, max_hp: 52, ... } }
{ type: "combat_state", data: { active_player: "thorin", initiative: [...] } }
{ type: "action_status", action_id: "act_001", status: "resolved" }
{ type: "system", content: "Connected as Thorin Ironforge" }

// Outgoing to server:
{ type: "auth", token: "aX7kM9" }
{ type: "action", text: "I attack the orc" }
```

## Dependencies

- [ ] Task #149 (Web Server Core) — needs server to serve static files and WebSocket endpoint
- [ ] No external dependencies (vanilla HTML/CSS/JS)

## Effort Estimate

- Size: L
- Hours: 10-12h
- Parallel: true (can run in parallel with Task #150 Action Queue)

## Definition of Done

- [ ] Page loads and renders correctly on iPhone (Safari), Android (Chrome), and desktop
- [ ] WebSocket connects, receives messages, and updates UI in real-time
- [ ] Action input works: type text, press send, see status indicator
- [ ] Character summary displays and updates
- [ ] Private messages render in dedicated section
- [ ] Dark theme looks good on all screen sizes
- [ ] No external CDN or framework dependencies
- [ ] Lighthouse mobile score ≥ 80 (performance)
