---
name: Rulebook Data Models
status: completed
created: 2026-02-02T03:47:06Z
updated: 2026-02-02T04:01:23Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/12
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Rulebook Data Models

## Description

Create Pydantic models for rulebook content. These models represent the structured data from SRD, Open5e, and custom rulebooks. Models should be comprehensive enough to capture all SRD data while remaining extensible for homebrew.

## Acceptance Criteria

- [ ] Create `src/gamemaster_mcp/rulebooks/models.py` with all models
- [ ] `Rulebook` model with metadata (name, version, source, loaded_at)
- [ ] `ClassDefinition` model with features per level, hit dice, proficiencies, spell slots
- [ ] `SubclassDefinition` model linked to parent class
- [ ] `RaceDefinition` model with ability bonuses, traits, size, speed, languages
- [ ] `SubraceDefinition` model linked to parent race
- [ ] `SpellDefinition` model (extends existing Spell with casting classes, ritual flag)
- [ ] `MonsterDefinition` model with full stat block (AC, HP, abilities, actions, legendary)
- [ ] `FeatDefinition` model with prerequisites and effects
- [ ] `BackgroundDefinition` model with proficiencies, languages, equipment, feature
- [ ] `ItemDefinition` model with properties, rarity, attunement
- [ ] All models inherit from BaseModel with proper Config
- [ ] All models have `source` field for attribution (srd, open5e, custom)
- [ ] JSON schema export works for custom rulebook validation

## Technical Details

### File Location
```
src/gamemaster_mcp/rulebooks/
├── __init__.py
└── models.py
```

### Key Models

```python
class ClassDefinition(BaseModel):
    index: str  # e.g., "wizard"
    name: str
    hit_die: int
    proficiencies: list[str]
    saving_throws: list[str]
    starting_equipment: list[str]
    spellcasting: SpellcastingInfo | None
    class_levels: dict[int, ClassLevelInfo]  # Level -> features
    subclasses: list[str]  # Subclass indexes
    source: str = "srd"

class MonsterDefinition(BaseModel):
    index: str
    name: str
    size: str
    type: str
    alignment: str
    armor_class: list[ArmorClassInfo]
    hit_points: int
    hit_dice: str
    speed: dict[str, int]
    ability_scores: AbilityScores
    saving_throws: dict[str, int] | None
    skills: dict[str, int] | None
    damage_resistances: list[str]
    damage_immunities: list[str]
    condition_immunities: list[str]
    senses: dict[str, str]
    languages: str
    challenge_rating: float
    xp: int
    special_abilities: list[MonsterAbility]
    actions: list[MonsterAction]
    legendary_actions: list[MonsterAction] | None
    source: str = "srd"
```

### Compatibility
- Use same patterns as existing `models.py` (BaseModel, Field, validators)
- Keep consistent with existing Character model for future validation integration

## Dependencies

- [ ] No task dependencies (foundation task)
- [ ] External: pydantic (already installed)

## Effort Estimate

- Size: M
- Parallel: true (no dependencies)

## Definition of Done

- [ ] All models defined with proper type hints
- [ ] Models can serialize to/from JSON
- [ ] Unit tests for model validation
- [ ] `__init__.py` exports public models
