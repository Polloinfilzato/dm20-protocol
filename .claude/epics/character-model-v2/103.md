---
name: "Integration & E2E Tests"
status: open
created: 2026-02-12T18:15:41Z
updated: 2026-02-12T18:20:09Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/104
depends_on: [98, 99, 100, 101, 102]
parallel: false
conflicts_with: []
---

# Task: Integration & E2E Tests

## Description

Create comprehensive end-to-end tests that validate the full character lifecycle: creation with SRD → level-up → inventory management → spell usage → rest mechanics. Test backward compatibility with existing campaign data. Validate multi-class-type coverage (Fighter/Ranger/Wizard). Ensure the full system works together as a cohesive whole.

## Acceptance Criteria

- [ ] E2E test: Create level 1 Fighter with SRD → verify 20+ populated fields → level up to 5 → verify all features/HP/proficiency bonus
- [ ] E2E test: Create level 3 Wood Elf Ranger with Outlander background → verify racial traits, class features, spell slots, starting equipment, proficiencies
- [ ] E2E test: Create level 5 Wizard → verify full spellcasting (spell slots, spells known, cantrips)
- [ ] E2E test: Full inventory cycle — add item → equip → unequip → remove
- [ ] E2E test: Full rest cycle — use spell slots → long rest → verify reset
- [ ] Backward compat test: Load v1 character JSON → verify no errors → update with new tools → save → reload
- [ ] E2E test: Create character without rulebook → verify clear error message
- [ ] E2E test: Standard array and point buy ability score generation
- [ ] Performance: Character creation < 2 seconds with SRD loaded
- [ ] All existing tests still pass (zero regressions)

## Technical Details

### Test File
- `tests/test_character_v2_e2e.py`

### Test Scenarios

**1. Fighter Lifecycle (Simple Martial)**
```python
# Create level 1 Human Fighter
# Verify: HP = 10 + CON mod, AC = 10, proficiency +2
# Verify: STR+CON saves, all armor/weapon proficiencies
# Level up to 2 → Action Surge
# Level up to 3 → Martial Archetype (Champion)
# Level up to 4 → ASI (+2 STR)
# Level up to 5 → Extra Attack, proficiency +3
# Verify all features accumulated correctly
```

**2. Ranger Lifecycle (Half-Caster)**
```python
# Create level 3 Wood Elf Ranger, Outlander background
# Verify: HP = 3d10 + CON×3, speed 35, DEX+WIS saves
# Verify: Darkvision, Fey Ancestry, Trance, Mask of the Wild
# Verify: Favored Enemy, Natural Explorer
# Verify: 3 spell slots (level 1), 3 spells known
# Verify: Outlander equipment and proficiencies
# Level up to 5 → Extra Attack, 2nd-level spells
```

**3. Wizard Lifecycle (Full Caster)**
```python
# Create level 5 Wizard
# Verify: HP = 5d6 + CON×5, INT saves
# Verify: Spell slots {1: 4, 2: 3, 3: 2}
# Verify: Arcane Recovery, Arcane Tradition at 2
# Use spell slot → verify decrement
# Long rest → verify slot reset
```

**4. Backward Compatibility**
```python
# Load a v1 character JSON (no new fields)
# Verify: loads without errors
# Verify: new fields have correct defaults
# Update character with new tools
# Save and reload → verify persistence
```

**5. Inventory Cycle**
```python
# Create character with starting equipment
# Equip longsword → weapon_main slot
# Equip shield → shield slot
# Unequip longsword → back to inventory
# Remove arrows (partial quantity)
```

### Files Created
- `tests/test_character_v2_e2e.py` (new)
- `tests/fixtures/v1_character.json` (test fixture for backward compat)

## Dependencies

- [ ] All previous tasks (#98-#102) must be complete
- [ ] SRD rulebook data available for testing

## Effort Estimate

- Size: S
- Hours: 2-3
- Parallel: false (depends on all other tasks)

## Definition of Done

- [ ] All E2E test scenarios implemented and passing
- [ ] Backward compat test with v1 JSON fixture
- [ ] Performance benchmark: creation < 2 seconds
- [ ] Zero regressions in existing test suite
- [ ] Test coverage > 80% on all new modules (character_builder, level_up_engine)
- [ ] CHANGELOG.md updated with full feature summary
- [ ] README.md updated with new MCP tools documentation
