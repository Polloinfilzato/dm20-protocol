---
name: "Inventory Management Tools"
status: open
created: 2026-02-12T18:15:41Z
updated: 2026-02-12T18:20:09Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/102
depends_on: [98]
parallel: true
conflicts_with: []
---

# Task: Inventory Management Tools

## Description

Add three new MCP tools for inventory management: `equip_item` (move item from inventory to equipment slot), `unequip_item` (move equipped item back to inventory), and `remove_item` (delete item from inventory). The Character model already has both `inventory: list[Item]` and `equipment: dict[str, Item | None]` with slots (weapon_main, weapon_off, armor, shield) — these tools bridge the gap by moving items between them.

## Acceptance Criteria

- [ ] New `equip_item` MCP tool: moves item from inventory to specified equipment slot
- [ ] New `unequip_item` MCP tool: moves item from equipment slot back to inventory
- [ ] New `remove_item` MCP tool: removes item from inventory by name or ID, with optional quantity
- [ ] `equip_item` validates: item exists in inventory, slot is valid (weapon_main, weapon_off, armor, shield), slot is empty (or auto-unequip current item)
- [ ] `unequip_item` validates: slot has an item equipped
- [ ] `remove_item` handles partial quantity removal (e.g., remove 3 of 5 arrows)
- [ ] All tools return clear confirmation messages
- [ ] Errors are descriptive: "Item 'Longsword' not found in inventory", "Slot 'armor' is already occupied by 'Chain Mail'"

## Technical Details

### MCP Tools (`main.py`)

```python
@mcp.tool()
async def equip_item(
    character_name_or_id: str,
    item_name_or_id: str,
    slot: str,  # weapon_main, weapon_off, armor, shield
) -> str:
    # 1. Find character
    # 2. Find item in inventory by name or ID
    # 3. Validate slot name
    # 4. If slot occupied: auto-unequip current item back to inventory
    # 5. Move item from inventory to equipment[slot]
    # 6. Save character

@mcp.tool()
async def unequip_item(
    character_name_or_id: str,
    slot: str,  # weapon_main, weapon_off, armor, shield
) -> str:
    # 1. Find character
    # 2. Validate slot has item
    # 3. Move item from equipment[slot] to inventory
    # 4. Set equipment[slot] = None
    # 5. Save character

@mcp.tool()
async def remove_item(
    character_name_or_id: str,
    item_name_or_id: str,
    quantity: int = 1,
) -> str:
    # 1. Find character
    # 2. Find item in inventory by name or ID
    # 3. If quantity < item.quantity: decrement
    # 4. If quantity >= item.quantity: remove entirely
    # 5. Save character
```

### Edge Cases
- Equipping an item when slot is full → auto-unequip first (with message)
- Removing more than available quantity → remove all, warn user
- Item lookup: try name first (case-insensitive), then ID
- Multiple items with same name → use first match, suggest using ID for specificity

### Files Modified
- `src/dm20_protocol/main.py` — 3 new MCP tools

## Dependencies

- [ ] Task #98 (Character Model Extension) — minimal dependency, mainly needs the model to be stable
- [ ] Existing Item model and equipment slots (already in v1)

## Effort Estimate

- Size: S
- Hours: 2-3
- Parallel: true (independent of Tasks #99, #100)

## Definition of Done

- [ ] equip_item MCP tool implemented and registered
- [ ] unequip_item MCP tool implemented and registered
- [ ] remove_item MCP tool implemented and registered
- [ ] Unit tests: equip/unequip round-trip
- [ ] Unit tests: remove with partial/full quantity
- [ ] Unit tests: error cases (item not found, invalid slot, empty slot)
- [ ] Unit tests: auto-unequip when slot is occupied
- [ ] All existing tests pass
- [ ] CHANGELOG.md updated
