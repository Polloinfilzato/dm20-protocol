---
name: Module scaffolding and base models
status: closed
created: 2026-02-17T17:01:12Z
updated: 2026-02-17T17:43:45Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/159
depends_on: []
parallel: false
conflicts_with: []
---

# Task: Module scaffolding and base models

## Description

Create the `importers/` module structure under `src/dm20_protocol/` with the DDB-specific subpackage, base result model, and DDB JSON schema constants. This is the foundation task — all other tasks depend on it.

## Acceptance Criteria

- [ ] `src/dm20_protocol/importers/__init__.py` exists with public API stubs
- [ ] `src/dm20_protocol/importers/base.py` exists with `ImportResult` Pydantic model
- [ ] `src/dm20_protocol/importers/dndbeyond/__init__.py` exists
- [ ] `src/dm20_protocol/importers/dndbeyond/schema.py` exists with DDB JSON constants (stat ID mapping, alignment lookup table, item type mapping, spell school mapping)
- [ ] `ImportResult` model has fields: `character`, `mapped_fields`, `unmapped_fields`, `warnings`, `source`, `ddb_character_id`
- [ ] All new modules are importable without errors

## Technical Details

### Files to create

1. **`importers/__init__.py`** — Re-export public functions (stubs for now):
   - `import_from_dndbeyond(url_or_id, player_name=None)`
   - `import_from_file(file_path, source_format=None, player_name=None)`

2. **`importers/base.py`** — Shared models:
   - `ImportResult(BaseModel)` with character, mapped_fields, unmapped_fields, warnings, source, ddb_character_id
   - `ImportError` custom exception class

3. **`importers/dndbeyond/__init__.py`** — Package init

4. **`importers/dndbeyond/schema.py`** — DDB JSON constants:
   - `STAT_ID_MAP = {1: "strength", 2: "dexterity", 3: "constitution", 4: "intelligence", 5: "wisdom", 6: "charisma"}`
   - `ALIGNMENT_MAP = {1: "Lawful Good", 2: "Neutral Good", ...}` (all 9 alignments)
   - `ITEM_FILTER_TYPE_MAP` — DDB filterType → dm20 item_type
   - `SPELL_SCHOOL_MAP` — DDB school strings
   - `MODIFIER_TYPE_MAP` — DDB modifier type constants
   - `DDB_CHARACTER_URL_PATTERN` — Regex for URL parsing
   - `DDB_API_BASE_URL` — character-service endpoint

### Design decisions

- Use Pydantic `BaseModel` for `ImportResult` (consistent with project conventions)
- Schema constants are plain dicts/strings — no classes needed
- Keep `__init__.py` exports minimal; actual implementations come in later tasks

## Dependencies

- [ ] None — this is the foundation task

## Effort Estimate

- Size: S
- Hours: 2
- Parallel: false (all other tasks depend on this)

## Definition of Done

- [ ] All module files created and importable
- [ ] `ImportResult` model validates correctly
- [ ] Schema constants cover all known DDB mappings
- [ ] No import errors when running `python -c "from dm20_protocol.importers import *"`
