---
name: DM Persona File
status: closed
created: 2026-02-09T01:33:04Z
updated: 2026-02-09T02:09:06Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/69
depends_on: [67, 68]
parallel: false
conflicts_with: []
---

# Task: DM Persona File

## Description

Create `.claude/dm-persona.md` — the core instruction file that tells Claude how to act as a Dungeon Master. This is the "brain" of the system: it defines identity, game loop, tool usage patterns, output formatting, authority rules, combat protocol, and session management.

This file is loaded only during gameplay (not during development) and references the MCP tools fixed in Tasks 67-68.

## Acceptance Criteria

- [ ] `.claude/dm-persona.md` created with comprehensive DM instructions
- [ ] Core game loop defined: CONTEXT → DECIDE → EXECUTE → PERSIST → NARRATE
- [ ] Tool usage patterns documented: which tool to use for each situation
- [ ] Output formatting defined: read-aloud boxes, NPC dialogue, combat logs, skill checks
- [ ] Authority rules defined: never ask player to DM, resolve ambiguity, rule of fun
- [ ] Combat protocol defined: initiative, turn management, attack resolution, basic enemy tactics
- [ ] Session management defined: start (new/resume), save, recap generation
- [ ] References `configure_claudmaster` settings (narrative_style, difficulty, dialogue_style)
- [ ] File size under 3000 tokens (to fit in context alongside conversation)
- [ ] DM persona works for freeform/homebrew campaigns (no module dependency)

## Technical Details

### File Location
`.claude/dm-persona.md` — A dedicated markdown file, NOT part of `.claude/CLAUDE.md`

### Structure
```markdown
# DM Persona: dm20-protocol

## Identity
[Who the DM is, tone, personality, adaptable to configure_claudmaster settings]

## Core Game Loop
[CONTEXT → DECIDE → EXECUTE → PERSIST → NARRATE — detailed instructions for each step]

## Tool Usage Patterns
[Categorized: exploration tools, combat tools, NPC tools, state management tools]
[When to use each, in what order, what data to extract]

## Output Formatting
[Read-aloud text style, NPC dialogue conventions, combat log format, skill check format]
[Dice roll presentation, damage/healing, status effects]

## Authority Rules
[Never break character, never ask player to DM, resolve ambiguity autonomously]
[Rule of fun, edge case handling, difficulty adaptation]

## Combat Protocol
[Initiative, turn order, attack sequence, damage application]
[Enemy tactics by archetype: melee brute, ranged, spellcaster, boss]
[When to flee, surrender, negotiate]

## Session Management
[New session: scene setting, character recap]
[Resume session: generate recap from session notes, set scene]
[Save session: generate session note, cliffhanger ending]
```

### Key Design Principles
- **State before narrative**: Always call tools to update game state BEFORE describing outcomes
- **Proactive tool use**: DM should call `roll_dice`, `search_rules` etc. without being asked
- **Structured → Creative**: Get structured data from tools, then apply creative narration
- **Concise instructions**: Each section should be actionable, not theoretical

### Reference
- [Claude Code Game Master](https://github.com/Sstobo/Claude-Code-Game-Master) — Validated pattern
- Existing `configure_claudmaster` settings for style adaptation

## Dependencies
- [ ] Task 67 (Tool Output Audit) — need to know what data tools return
- [ ] Task 68 (Session Tool Fixes) — need working session tools to reference

## Effort Estimate
- Size: L
- Hours: 6-8
- Parallel: false — depends on Tasks 67 and 68
- Conflicts: none

## Definition of Done
- [ ] `.claude/dm-persona.md` exists with all sections
- [ ] Instructions are actionable and reference real tool names
- [ ] File tested by loading in Claude Code and verifying DM behavior
- [ ] File size verified under 3000 tokens
