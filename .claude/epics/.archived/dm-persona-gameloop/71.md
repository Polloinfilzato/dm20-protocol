---
name: Game Skills (Slash Commands)
status: closed
created: 2026-02-09T01:33:04Z
updated: 2026-02-09T02:38:39Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/71
depends_on: [69]
parallel: true
conflicts_with: []
---

# Task: Game Skills (Slash Commands)

## Description

Create four slash command files in `.claude/commands/dm/` that provide the player-facing interface for gameplay: `/dm:start`, `/dm:action`, `/dm:combat`, `/dm:save`. These commands load the DM persona context and orchestrate the game loop.

## Acceptance Criteria

- [ ] `.claude/commands/dm/start.md` — Begin or resume a game session
- [ ] `.claude/commands/dm/action.md` — Process a player action through the game loop
- [ ] `.claude/commands/dm/combat.md` — Initiate or manage a combat encounter
- [ ] `.claude/commands/dm/save.md` — Save session state and pause
- [ ] Each command loads the DM persona context
- [ ] Commands follow the existing slash command format (see `.claude/commands/pm/` for examples)
- [ ] Commands reference actual MCP tool names
- [ ] Error handling: commands give clear feedback when prerequisites aren't met (no campaign loaded, no character, etc.)

## Technical Details

### Command Format
Check existing commands in `.claude/commands/pm/` for the exact format. Commands are markdown files with:
- Title
- Usage section
- Instructions section with step-by-step process

### /dm:start
**Purpose:** Load campaign, initialize/resume session, set opening scene
**Steps:**
1. Check for active campaign (if none, ask user to select)
2. Load campaign info via `get_campaign_info`
3. Load characters via `list_characters`
4. Get game state via `get_game_state`
5. Check for existing Claudmaster session via `get_claudmaster_session_state`
6. If resuming: load session, generate recap from session notes
7. If new: call `start_claudmaster_session`, set opening scene
8. Load DM persona from `.claude/dm-persona.md`
9. Present scene description, await player action

### /dm:action [description]
**Purpose:** Core game loop — process a player action
**Args:** Player action description (natural language)
**Steps:**
1. Ensure DM persona is active
2. Follow CONTEXT → DECIDE → EXECUTE → PERSIST → NARRATE loop
3. Get current game state
4. Determine what happens (check needed? NPC reaction? combat trigger?)
5. Execute appropriate tool calls (roll_dice, search_rules, etc.)
6. Update game state (update_character, add_event, etc.)
7. Narrate outcome to player
8. Optionally spawn sub-agents for complex scenarios

### /dm:combat [situation]
**Purpose:** Enter or manage combat
**Args:** Optional situation description
**Steps:**
1. Identify all combatants (PCs, NPCs, monsters)
2. Roll initiative for all participants via `roll_dice`
3. Call `start_combat` with initiative order
4. Enter combat loop:
   - Announce current turn
   - If player's turn: await action
   - If NPC/monster turn: determine and execute action
   - Resolve attacks, damage, conditions
   - Call `next_turn` to advance
5. When combat ends: `end_combat`, narrate aftermath
6. Handle XP distribution via `calculate_experience`

### /dm:save
**Purpose:** Save session and pause game
**Steps:**
1. Generate session summary from events this session
2. Call `add_session_note` with summary
3. Call `end_claudmaster_session` with mode="pause"
4. Provide cliffhanger or natural stopping point narrative
5. Confirm save to player with session stats

## Dependencies
- [ ] Task 69 (DM Persona File) — commands reference persona instructions

## Effort Estimate
- Size: M
- Hours: 4-6
- Parallel: true (can run alongside Task 70)
- Conflicts: none

## Definition of Done
- [ ] 4 command files created in `.claude/commands/dm/`
- [ ] Commands follow existing project command format
- [ ] Commands reference real MCP tool names
- [ ] Commands load DM persona context
- [ ] Error handling for missing prerequisites
