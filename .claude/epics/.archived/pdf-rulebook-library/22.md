---
name: Library directory structure and LibraryManager base class
status: completed
created: 2026-02-02T20:05:44Z
updated: 2026-02-02T20:26:16Z
github: https://github.com/Polloinfilzato/gamemaster-mcp/issues/22
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Library directory structure and LibraryManager base class

## Description

Create the foundational directory structure for the PDF library system and implement the `LibraryManager` class that orchestrates all library operations. This establishes the skeleton that all subsequent tasks will build upon.

## Acceptance Criteria

- [x] Create `src/gamemaster_mcp/library/` package with `__init__.py`
- [x] Create `LibraryManager` class with basic structure
- [x] Implement library directory detection/creation (`dnd_data/library/`)
- [x] Create subdirectories: `pdfs/`, `index/`, `extracted/`
- [x] Add `library_dir` property to `DnDStorage`
- [x] Implement `scan_library()` method stub (returns list of PDF/MD files)
- [x] Implement `list_library()` method stub (returns indexed sources)
- [x] Add PyMuPDF to dependencies (pyproject.toml)
- [x] Unit tests for directory structure and basic operations

## Technical Details

### Files to Create

```
src/gamemaster_mcp/library/
├── __init__.py           # Export LibraryManager
├── manager.py            # LibraryManager class
└── models.py             # LibrarySource, IndexEntry dataclasses
```

### LibraryManager Interface

```python
class LibraryManager:
    def __init__(self, library_dir: Path):
        self.library_dir = library_dir
        self.pdfs_dir = library_dir / "pdfs"
        self.index_dir = library_dir / "index"
        self.extracted_dir = library_dir / "extracted"

    def ensure_directories(self) -> None: ...
    def scan_library(self) -> list[Path]: ...  # Find PDF/MD files
    def list_library(self) -> list[LibrarySource]: ...  # List indexed sources
    def get_source(self, source_id: str) -> LibrarySource | None: ...
```

### DnDStorage Integration

Add to `storage.py`:
```python
@property
def library_dir(self) -> Path:
    return self.data_dir / "library"

@property
def library_manager(self) -> LibraryManager | None:
    # Lazy initialization
```

### Dependencies

Add to `pyproject.toml`:
```toml
dependencies = [
    # ... existing
    "pymupdf>=1.23.0",
]
```

## Dependencies

- [ ] None - this is the foundation task

## Effort Estimate

- Size: M
- Hours: 4-6
- Parallel: true (no dependencies)

## Definition of Done

- [x] Code implemented with type hints
- [x] Unit tests written and passing
- [x] Directory structure auto-created on first access
- [x] LibraryManager importable from `gamemaster_mcp.library`
- [x] PyMuPDF installed and importable
