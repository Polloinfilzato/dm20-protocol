---
name: ChromaDB Vector Store Setup
status: completed
created: 2026-02-05T19:06:45Z
updated: 2026-02-05T19:21:30Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/34
depends_on: [33]
parallel: true
conflicts_with: []
---

# ChromaDB Vector Store Setup

## Description

Set up ChromaDB as the vector store backend for the Module Keeper agent's RAG (Retrieval-Augmented Generation) system. This includes adding the ChromaDB dependency, creating a VectorStoreManager class to handle all vector operations, configuring the embedding model using sentence-transformers, and implementing collection management on a per-module basis.

## Acceptance Criteria

- [ ] Add ChromaDB and sentence-transformers as project dependencies
- [ ] Create `VectorStoreManager` class in `src/gamemaster_mcp/claudmaster/vector_store.py`
- [ ] Configure default embedding model (all-MiniLM-L6-v2 or similar)
- [ ] Implement collection creation per adventure module
- [ ] Implement collection deletion and cleanup
- [ ] Add methods for document insertion with metadata
- [ ] Add methods for similarity search with configurable top-k
- [ ] Support persistent storage in campaign directory
- [ ] Handle embedding model initialization and caching
- [ ] Add unit tests for VectorStoreManager
- [ ] Include docstrings for all public methods

## Technical Details

### File Location

```
src/gamemaster_mcp/claudmaster/
├── vector_store.py      # VectorStoreManager class
└── ...
```

### VectorStoreManager Class Interface

```python
from typing import List, Dict, Any, Optional

class VectorStoreManager:
    """Manages ChromaDB vector store for RAG operations."""

    def __init__(self, persist_directory: str, embedding_model: str = "all-MiniLM-L6-v2"):
        """Initialize with persistent storage path and embedding model."""
        pass

    def create_collection(self, module_id: str, metadata: Optional[Dict] = None) -> None:
        """Create a new collection for an adventure module."""
        pass

    def delete_collection(self, module_id: str) -> None:
        """Delete a module's collection."""
        pass

    def list_collections(self) -> List[str]:
        """List all module collections."""
        pass

    def add_documents(
        self,
        module_id: str,
        documents: List[str],
        metadatas: List[Dict[str, Any]],
        ids: List[str]
    ) -> None:
        """Add documents to a module's collection with metadata."""
        pass

    def query(
        self,
        module_id: str,
        query_text: str,
        n_results: int = 5,
        where: Optional[Dict] = None
    ) -> List[Dict[str, Any]]:
        """Query for similar documents with optional metadata filter."""
        pass
```

### Metadata Schema for Documents

Each document chunk should include metadata:
- `chapter`: Chapter name/number
- `section`: Section within chapter
- `content_type`: "narrative", "encounter", "npc", "location", "item"
- `page_range`: Original PDF page range
- `chunk_index`: Position in original text

### Dependencies to Add

```toml
# pyproject.toml
chromadb = "^0.4.0"
sentence-transformers = "^2.2.0"
```

### Storage Structure

```
campaigns/{campaign_name}/
├── campaign.json
├── chromadb/              # Vector store persistent directory
│   └── {module_id}/       # Per-module collections
└── ...
```

## Dependencies

- Task #32 (Claudmaster Directory Structure) - requires base directory structure

## Effort Estimate

- **Size:** M
- **Estimated Hours:** 6
- **Complexity:** Medium - integrating external vector DB library

## Definition of Done

1. ChromaDB and sentence-transformers added to project dependencies
2. VectorStoreManager class fully implemented
3. Collection management (create, delete, list) working
4. Document insertion with metadata working
5. Similarity search returning relevant results
6. Persistent storage survives application restarts
7. Embedding model loads efficiently with caching
8. All unit tests passing
9. Code passes linting and type checking
10. Documentation complete
