---
name: Orchestrator Skeleton
status: completed
created: 2026-02-05T19:06:45Z
updated: 2026-02-06T23:08:03Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/31
depends_on: [33]
parallel: false
conflicts_with: []
---

# Orchestrator Skeleton

## Description

Implement the central Orchestrator class that coordinates all Claudmaster agents, manages the game turn flow, and integrates with the existing campaign system. The Orchestrator is the heart of the AI DM system, responsible for routing player input to appropriate agents and aggregating their responses into coherent game actions.

## Acceptance Criteria

- [ ] Implement `Orchestrator` class with agent registration system
- [ ] Define agent communication protocol (request/response types)
- [ ] Implement turn flow management with proper sequencing
- [ ] Integrate with existing `Campaign` and `GameState` systems
- [ ] Support async agent execution for parallel processing
- [ ] Add error handling and recovery mechanisms
- [ ] Create comprehensive unit tests
- [ ] Document the orchestration flow

## Technical Details

### Orchestrator Class

```python
class Orchestrator:
    """Coordinates agents and manages game flow."""

    def __init__(self, campaign: Campaign, config: ClaudmasterConfig):
        self.campaign = campaign
        self.config = config
        self.agents: dict[str, Agent] = {}
        self.session: ClaudmasterSession = None

    def register_agent(self, name: str, agent: Agent) -> None:
        """Register an agent with the orchestrator."""
        pass

    async def process_player_input(self, input: str) -> OrchestratorResponse:
        """Main entry point for player actions."""
        pass

    async def execute_turn(self) -> TurnResult:
        """Execute a complete game turn."""
        pass
```

### Communication Protocol

Define typed request/response classes:
- `AgentRequest`: What the orchestrator asks an agent to do
- `AgentResponse`: What the agent returns
- `OrchestratorResponse`: Final aggregated response to player

### Turn Flow

1. Receive player input
2. Classify intent (action, question, roleplay, etc.)
3. Route to appropriate agent(s)
4. Collect and merge responses
5. Update game state
6. Return narrative response

### Campaign Integration

- Read current game state from Campaign
- Update game state through existing tools
- Respect campaign configuration and rules

## Dependencies

- Task #32: Claudmaster Directory Structure and Base Classes
  - Requires Agent base class
  - Requires ClaudmasterConfig
  - Requires ClaudmasterSession

## Effort Estimate

- **Size:** L
- **Estimated Hours:** 10
- **Complexity:** High - central coordination logic

## Definition of Done

1. Orchestrator class fully implemented
2. Agent registration and management working
3. Communication protocol defined with types
4. Turn flow correctly sequences agent calls
5. Campaign system integration complete
6. Async execution supported
7. Error handling in place
8. Unit tests written and passing
9. Integration tests with mock agents
10. Code reviewed and approved
