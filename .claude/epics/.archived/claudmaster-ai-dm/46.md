---
name: Scene Atmosphere and Pacing
status: completed
created: 2026-02-05T19:06:45Z
updated: 2026-02-05T19:21:30Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/43
depends_on: [42]
parallel: true
conflicts_with: []
---

# Scene Atmosphere and Pacing

## Description

Implement a scene atmosphere and pacing system that detects and applies appropriate tones from module data (horror, heroic, mysterious, etc.) and adjusts narrative pacing based on scene type. This system ensures tension building for encounters, calm moments for roleplay, and smooth transitions between different scene types.

## Acceptance Criteria

- [ ] Detect tone from module/scene metadata (horror, heroic, tense, etc.)
- [ ] Apply tone to narrative descriptions
- [ ] Adjust pacing based on scene type (combat, exploration, social)
- [ ] Build tension for upcoming encounters
- [ ] Create calm moments for roleplay and recovery
- [ ] Handle smooth tone transitions between scenes
- [ ] Support mixed-tone scenes (comedy in horror, etc.)
- [ ] Create unit tests for tone detection and application
- [ ] Add integration tests with module data

## Technical Details

### AtmosphereManager Class

```python
class AtmosphereManager:
    """Manages scene atmosphere and narrative pacing."""

    def __init__(self, narrator_agent: NarratorAgent):
        self.narrator = narrator_agent
        self.current_tone: Tone = Tone.NEUTRAL
        self.tension_level: float = 0.5  # 0.0 to 1.0
        self.pacing: Pacing = Pacing.NORMAL

    async def detect_tone(self, scene: Scene, module: Optional[Module]) -> Tone:
        """Detect appropriate tone from scene and module data."""
        pass

    async def apply_atmosphere(
        self,
        narrative: str,
        tone: Tone,
        intensity: float
    ) -> str:
        """Modify narrative to match atmospheric tone."""
        pass

    async def adjust_pacing(
        self,
        scene_type: SceneType,
        player_actions: list[ParsedAction]
    ) -> Pacing:
        """Determine appropriate pacing for current scene."""
        pass

    async def build_tension(
        self,
        current_level: float,
        target_level: float,
        description: str
    ) -> str:
        """Add tension-building elements to description."""
        pass

    async def transition_tone(
        self,
        from_tone: Tone,
        to_tone: Tone,
        trigger: str
    ) -> str:
        """Generate smooth transition between tones."""
        pass
```

### Tone Enumeration

```python
class Tone(Enum):
    NEUTRAL = "neutral"
    HEROIC = "heroic"
    HORROR = "horror"
    MYSTERIOUS = "mysterious"
    COMEDIC = "comedic"
    TRAGIC = "tragic"
    TENSE = "tense"
    PEACEFUL = "peaceful"
    OMINOUS = "ominous"
    TRIUMPHANT = "triumphant"
    DESPERATE = "desperate"
    WONDER = "wonder"
```

### Pacing Enumeration

```python
class Pacing(Enum):
    SLOW = "slow"        # Detailed descriptions, exploration
    NORMAL = "normal"    # Standard play
    FAST = "fast"        # Combat, action sequences
    FRANTIC = "frantic"  # Chase scenes, emergencies
    DELIBERATE = "deliberate"  # Puzzle solving, investigation
```

### Tone Detection Rules

```python
TONE_INDICATORS = {
    Tone.HORROR: {
        "keywords": ["dark", "creeping", "dread", "undead", "corruption"],
        "creature_types": ["undead", "aberration", "fiend"],
        "environment": ["dungeon", "crypt", "swamp", "ruins"],
        "time": ["night", "midnight", "witching hour"]
    },
    Tone.HEROIC: {
        "keywords": ["glory", "honor", "battle", "champion"],
        "creature_types": ["dragon", "giant"],
        "environment": ["battlefield", "castle", "arena"],
        "stakes": ["kingdom", "world", "innocent lives"]
    },
    # ... other tones
}
```

### Tension Building System

```python
@dataclass
class TensionState:
    level: float  # 0.0 (calm) to 1.0 (peak tension)
    build_rate: float  # How fast tension increases
    release_rate: float  # How fast tension decreases
    peak_threshold: float  # When climax should occur
    last_release: datetime  # Track pacing

class TensionBuilder:
    """Manages tension curves throughout scenes."""

    def calculate_tension_elements(self, level: float) -> TensionElements:
        """Determine what elements to add based on tension level."""
        if level < 0.3:
            return TensionElements(
                sensory_hints=["distant sounds", "subtle movements"],
                pacing="measured",
                detail_level="normal"
            )
        elif level < 0.6:
            return TensionElements(
                sensory_hints=["closer sounds", "shadows moving"],
                pacing="quickening",
                detail_level="heightened"
            )
        # ... escalating elements
```

### Scene Type Pacing Rules

```python
PACING_BY_SCENE = {
    SceneType.COMBAT: {
        "default": Pacing.FAST,
        "boss_fight": Pacing.NORMAL,  # More dramatic weight
        "cleanup": Pacing.FRANTIC  # Quick resolution
    },
    SceneType.EXPLORATION: {
        "default": Pacing.SLOW,
        "time_pressure": Pacing.NORMAL,
        "chase": Pacing.FRANTIC
    },
    SceneType.SOCIAL: {
        "default": Pacing.NORMAL,
        "negotiation": Pacing.DELIBERATE,
        "celebration": Pacing.SLOW
    },
    SceneType.PUZZLE: {
        "default": Pacing.DELIBERATE,
        "timed_puzzle": Pacing.FAST
    }
}
```

### Atmosphere Modifiers

Apply tone through word choice and structure:
```python
TONE_MODIFIERS = {
    Tone.HORROR: {
        "verbs": ["creeps", "lurks", "slithers", "whispers"],
        "adjectives": ["cold", "damp", "rotting", "unseen"],
        "sentence_structure": "short, punchy sentences. Then longer ones that build dread.",
        "sensory_focus": ["sound", "smell", "touch"]
    },
    Tone.HEROIC: {
        "verbs": ["charges", "stands", "rallies", "defies"],
        "adjectives": ["bold", "gleaming", "mighty", "resolute"],
        "sentence_structure": "flowing, epic prose with dramatic pauses",
        "sensory_focus": ["sight", "sound"]
    },
    # ... other tones
}
```

## Dependencies

- Task 41: Enhanced Narrator with NPC Dialogue

## Effort Estimate

- **Size:** M
- **Estimated Hours:** 6
- **Complexity:** Medium - creative systems with multiple interacting components

## Definition of Done

1. AtmosphereManager class fully implemented
2. Tone detection working from scene/module data
3. Atmosphere correctly applied to narratives
4. Pacing adjusts appropriately by scene type
5. Tension building system functional
6. Tone transitions feel natural
7. Mixed-tone scenes handled gracefully
8. All unit tests passing
9. Integration tests with module data passing
10. Documentation complete with examples
11. Code reviewed and approved
