---
name: Basic Narrator Agent
status: completed
created: 2026-02-05T19:06:45Z
updated: 2026-02-05T19:21:30Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/32
depends_on: [33]
parallel: true
conflicts_with: []
---

# Basic Narrator Agent

## Description

Implement the NarratorAgent class as the first concrete agent in the Claudmaster system. The Narrator is responsible for generating evocative scene descriptions, setting the mood, and conveying the game world to players. This agent integrates with Claude API for LLM-powered narrative generation.

## Acceptance Criteria

- [ ] Implement `NarratorAgent` class extending base `Agent`
- [ ] Implement ReAct pattern methods (reason, act, observe)
- [ ] Create basic scene description generation capability
- [ ] Integrate with Claude API for LLM calls
- [ ] Design and implement prompt template system
- [ ] Support different narrative styles (descriptive, terse, dramatic)
- [ ] Add context-awareness for campaign setting
- [ ] Create unit tests with mocked LLM responses
- [ ] Document prompt engineering decisions

## Technical Details

### NarratorAgent Class

```python
class NarratorAgent(Agent):
    """Agent responsible for narrative scene descriptions."""

    def __init__(self, config: ClaudmasterConfig, llm_client: Any):
        self.config = config
        self.llm = llm_client
        self.style = config.narrative_style

    async def reason(self, context: dict) -> str:
        """Analyze what kind of description is needed."""
        pass

    async def act(self, reasoning: str) -> str:
        """Generate the narrative description."""
        pass

    async def observe(self, result: str) -> dict:
        """Validate and refine the generated narrative."""
        pass

    async def describe_scene(self, location: Location, context: dict) -> str:
        """High-level method for scene description."""
        pass
```

### Prompt Template System

Create modular prompts that include:
- Campaign setting context
- Current location details
- Recent events
- Narrative style instructions
- Tone and mood guidance

Example template structure:
```python
SCENE_DESCRIPTION_TEMPLATE = """
You are a narrator for a {setting} campaign.
Current location: {location_name}
{location_description}

Recent events: {recent_events}

Narrative style: {style}

Generate a vivid scene description for the players who have just:
{player_action}
"""
```

### LLM Integration

- Use Anthropic Claude API
- Support configurable model selection
- Implement retry logic with exponential backoff
- Handle rate limiting gracefully
- Cache similar requests when appropriate

### Narrative Styles

- `descriptive`: Rich, detailed prose
- `terse`: Brief, action-focused
- `dramatic`: Theatrical, tension-building
- `mysterious`: Hints and atmosphere

## Dependencies

- Task #32: Claudmaster Directory Structure and Base Classes
  - Requires Agent abstract class
  - Requires ClaudmasterConfig for style settings

**Note:** Can be developed in parallel with Task #33 (Orchestrator) since both depend only on #32

## Effort Estimate

- **Size:** M
- **Estimated Hours:** 8
- **Complexity:** Medium - LLM integration and prompt engineering

## Definition of Done

1. NarratorAgent class fully implements Agent interface
2. ReAct pattern methods working correctly
3. Claude API integration functional
4. Prompt templates designed and tested
5. Multiple narrative styles supported
6. Context-aware descriptions generated
7. Unit tests with mocked LLM passing
8. Error handling for API failures
9. Documentation complete
10. Code reviewed and approved
