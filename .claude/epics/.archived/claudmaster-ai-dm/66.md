---
name: Session Continuity and Recaps
status: completed
created: 2026-02-05T19:06:45Z
updated: 2026-02-07T10:45:16Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/63
depends_on: [47, 65]
parallel: false
conflicts_with: []
---

# Session Continuity and Recaps

## Description

Implement session continuity features that ensure smooth transitions between play sessions. This includes automatic session state saving on pause, intelligent session recap generation when resuming, and "Previously on..." style narrative summaries that help players quickly recall where they left off.

## Acceptance Criteria

- [ ] Implement auto-save functionality on session pause/interruption
- [ ] Create session recap generator for resuming sessions
- [ ] Generate "Previously on..." narrative summary
- [ ] Summarize key events from previous session
- [ ] Highlight unresolved threads and active quests
- [ ] Remind players of their current situation/location
- [ ] Include NPC relationship status reminders
- [ ] Support different recap lengths (brief, standard, detailed)
- [ ] Generate recap in narrative voice (not bullet points)
- [ ] Store recap configuration per campaign
- [ ] Add tests for recap generation

## Technical Details

### Auto-Save System

```python
class AutoSaveManager:
    """Manages automatic session state preservation."""

    def __init__(
        self,
        session: ClaudmasterSession,
        save_interval_minutes: int = 5
    ):
        self.session = session
        self.save_interval = save_interval_minutes
        self.last_save: datetime = None

    async def trigger_autosave(self) -> None:
        """Save session state if interval has passed."""

    async def save_on_interrupt(self) -> None:
        """Immediate save when session is interrupted."""

    def mark_checkpoint(self, description: str) -> None:
        """Create named checkpoint for significant events."""
```

### Recap Generator

```python
class SessionRecapGenerator:
    """Generates narrative recaps for session continuity."""

    def __init__(
        self,
        session: ClaudmasterSession,
        fact_database: FactDatabase
    ):
        self.session = session
        self.facts = fact_database

    async def generate_recap(
        self,
        length: str = "standard",  # "brief", "standard", "detailed"
        style: str = "narrative"   # "narrative", "bullet", "mixed"
    ) -> SessionRecap:
        """Generate a session recap for resuming play."""

    def get_key_events(self, limit: int = 5) -> list[Fact]:
        """Extract most important events from last session."""

    def get_active_threads(self) -> list[StoryThread]:
        """Identify unresolved plot threads."""

    def get_situation_summary(self) -> str:
        """Describe current party situation."""
```

### Recap Content Structure

```python
@dataclass
class SessionRecap:
    previously_on: str          # "Previously on..." narrative
    key_events: list[str]       # Important things that happened
    active_quests: list[QuestSummary]
    unresolved_threads: list[str]
    current_situation: str      # Where the party is now
    party_status: str           # Brief party condition summary
    npc_reminders: list[str]    # Important NPC relationships
    suggested_hooks: list[str]  # Where to pick up the story
```

### "Previously On..." Generation

The recap narrative should:
1. Open with dramatic/atmospheric scene-setting
2. Summarize 3-5 most significant events
3. End with current situation and implied next steps
4. Match the tone of the campaign/module
5. Be concise but evocative (150-300 words for standard)

Example:
```
"Previously on Shadows Over Eldoria...

The party delved into the ancient crypt beneath Thornwood, where they
discovered a portal to the Shadowfell pulsing with dark energy. After
a fierce battle with shadow wraiths, they recovered the Amulet of
Dawning - though not before Thorne the dwarf was afflicted with a
mysterious curse that dims the light around him.

Elder Miriam revealed that the portal's power grows with each passing
day, and only the Sunstone, hidden in the Feywild, can close it
permanently. She spoke of an old contact who might know the way...

We rejoin our heroes at the Crossroads Inn, nursing their wounds and
debating their next move. The clock is ticking, and dark forces gather
in the shadows."
```

### Configuration

```yaml
# In claudmaster_config.yaml
session_continuity:
  auto_save:
    enabled: true
    interval_minutes: 5
    max_checkpoints: 10
  recap:
    default_length: standard
    default_style: narrative
    include_npc_reminders: true
    max_key_events: 5
```

### File Structure

```
src/gamemaster_mcp/claudmaster/
├── continuity/
│   ├── __init__.py
│   ├── auto_save.py         # AutoSaveManager
│   └── recap_generator.py   # SessionRecapGenerator
```

## Dependencies

- Task #46: Fact Tracker System (for retrieving session facts)
- Task #64: end_session and get_session_state MCP Tools (for session persistence)

## Effort Estimate

- **Size:** M
- **Estimated Hours:** 6
- **Complexity:** Medium - narrative generation and fact synthesis

## Definition of Done

1. Auto-save system implemented and working
2. Auto-save triggers on interval and interruption
3. SessionRecapGenerator fully implemented
4. "Previously on..." narrative generation working
5. Key event extraction from fact database working
6. Active quest/thread identification working
7. All recap lengths supported (brief, standard, detailed)
8. Narrative style matches campaign tone
9. Configuration options working
10. Unit tests for recap generation
11. Integration tests with fact database
12. Documentation for recap customization
