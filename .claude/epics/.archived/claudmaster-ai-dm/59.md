---
name: Multiple PC Tracking
status: completed
created: 2026-02-05T19:06:45Z
updated: 2026-02-07T01:48:13Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/56
depends_on: [34]
parallel: true
conflicts_with: []
---

# Multiple PC Tracking

## Description

Implement support for tracking multiple player characters within a single game session. This foundational multi-player feature enables the Orchestrator to identify individual PCs, maintain per-character state, and manage a configurable list of active players in the campaign. This is essential for any multi-player D&D experience where each player controls their own character.

## Acceptance Criteria

- [ ] Add PC identification system to the Orchestrator
- [ ] Implement per-PC state tracking (current action, location, status effects)
- [ ] Create PC list configuration in campaign settings
- [ ] Support dynamic PC join/leave during session
- [ ] Track individual PC initiative and turn order
- [ ] Maintain separate action queues per PC
- [ ] Handle PC-specific context in agent communications
- [ ] Create unit tests for multi-PC scenarios
- [ ] Document multi-player configuration

## Technical Details

### PC Registry in Orchestrator

```python
@dataclass
class PCState:
    """Tracks the current state of a player character."""
    character_id: str
    player_name: str
    current_action: Optional[str] = None
    location: Optional[str] = None
    is_active: bool = True
    last_action_time: datetime = None
    status_effects: list[str] = field(default_factory=list)
    private_notes: list[str] = field(default_factory=list)

class Orchestrator:
    """Extended with multi-PC support."""

    def __init__(self, campaign: Campaign, config: ClaudmasterConfig):
        self.pc_registry: dict[str, PCState] = {}
        self.active_pc: Optional[str] = None
        # ... existing init

    def register_pc(self, character: Character, player_name: str) -> PCState:
        """Register a player character for the session."""
        pass

    def get_pc_state(self, character_id: str) -> PCState:
        """Get current state for a specific PC."""
        pass

    def update_pc_state(self, character_id: str, **updates) -> None:
        """Update state for a specific PC."""
        pass

    def identify_acting_pc(self, input: str) -> Optional[str]:
        """Identify which PC is taking an action from input."""
        pass
```

### Campaign Configuration Extension

```python
@dataclass
class MultiPlayerConfig:
    """Configuration for multi-player sessions."""
    max_players: int = 6
    allow_dynamic_join: bool = True
    turn_timeout_seconds: int = 300
    simultaneous_actions: bool = False
    pc_list: list[str] = field(default_factory=list)  # Character IDs
```

### PC Identification Strategies

1. **Explicit naming**: "Gandalf attacks the orc"
2. **Pronoun resolution**: Track who spoke last
3. **Context inference**: Combat turn order
4. **Player name mapping**: "John: I cast fireball"

### State Synchronization

- Sync PC states with Character records in campaign
- Track temporary vs permanent state changes
- Handle state conflicts between players

## Dependencies

- Task #33: Orchestrator Skeleton
  - Requires Orchestrator class foundation
  - Requires agent communication protocol
  - Requires session management

## Effort Estimate

- **Size:** M
- **Estimated Hours:** 6
- **Complexity:** Medium - state management with multiple entities

## Definition of Done

1. PC registry implemented in Orchestrator
2. Per-PC state tracking working correctly
3. Campaign configuration extended for multi-player
4. PC identification from input working
5. Dynamic join/leave supported
6. State synchronization with Character records
7. All unit tests passing
8. Integration tests with mock players
9. Documentation complete
10. Code reviewed and approved
