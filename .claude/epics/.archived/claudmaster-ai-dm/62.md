---
name: Player-Specific Information
status: completed
created: 2026-02-05T19:06:45Z
updated: 2026-02-07T09:23:03Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/59
depends_on: [59]
parallel: true
conflicts_with: []
---

# Player-Specific Information

## Description

Implement a system for managing player-specific information that should not be shared with other players. This includes private notes to individual players, secret knowledge known only to specific PCs, hidden roll results, and the equivalent of DM-to-player whispers in a tabletop setting. This feature is essential for maintaining mystery, individual character secrets, and dramatic tension in multi-player games.

## Acceptance Criteria

- [ ] Implement private message system for individual players
- [ ] Track secret knowledge per PC
- [ ] Support hidden roll results (only player sees their roll)
- [ ] Create DM-to-player equivalent messaging
- [ ] Handle secret perception/insight checks
- [ ] Manage character secrets and backgrounds
- [ ] Support private inventory reveals
- [ ] Track "known by" metadata for information
- [ ] Create unit tests for privacy mechanics
- [ ] Document private information handling

## Technical Details

### PrivateInfo Management

```python
class InfoVisibility(Enum):
    PUBLIC = "public"           # Everyone sees
    PARTY = "party"             # All PCs see
    PRIVATE = "private"         # Single PC sees
    DM_ONLY = "dm_only"         # Not shown to any player
    SUBSET = "subset"           # Specific list of PCs

@dataclass
class PrivateInfo:
    """Information with restricted visibility."""
    info_id: str
    content: str
    visibility: InfoVisibility
    visible_to: set[str]        # PC IDs if SUBSET
    source: str                 # Where/how learned
    learned_at: datetime
    can_share: bool = True      # Can PC tell others?
    expires: Optional[datetime] = None

class PrivateInfoManager:
    """Manages player-specific information."""

    def __init__(self, orchestrator: Orchestrator):
        self.orchestrator = orchestrator
        self.info_store: dict[str, list[PrivateInfo]] = {}  # PC ID -> info
        self.pending_reveals: list[PrivateInfo] = []

    def add_private_info(self, pc_id: str, content: str, **kwargs) -> PrivateInfo:
        """Add private information for a specific PC."""
        pass

    def get_visible_info(self, pc_id: str) -> list[PrivateInfo]:
        """Get all information visible to a PC."""
        pass

    def share_info(self, from_pc: str, to_pc: str, info_id: str) -> bool:
        """PC shares private information with another PC."""
        pass

    def check_knowledge(self, pc_id: str, topic: str) -> Optional[PrivateInfo]:
        """Check if PC has private knowledge about a topic."""
        pass
```

### Private Messaging

```python
@dataclass
class PrivateMessage:
    """A message visible only to specific player(s)."""
    message_id: str
    content: str
    recipients: set[str]  # PC IDs
    message_type: str     # "dm_note", "roll_result", "secret", etc.
    timestamp: datetime
    read_by: set[str] = field(default_factory=set)

class PrivateInfoManager:
    def send_private_message(
        self,
        content: str,
        recipients: set[str],
        message_type: str = "dm_note"
    ) -> PrivateMessage:
        """Send a private message to specific players."""
        pass

    def get_pending_messages(self, pc_id: str) -> list[PrivateMessage]:
        """Get unread private messages for a PC."""
        pass

    def format_dm_whisper(self, pc_id: str, content: str) -> str:
        """Format a DM-to-player whisper."""
        return f"[Private to {self.get_player_name(pc_id)}]: {content}"
```

### Hidden Roll Results

```python
@dataclass
class HiddenRoll:
    """A roll result hidden from other players."""
    roll_id: str
    pc_id: str
    roll_type: str      # "perception", "insight", "stealth", etc.
    result: int
    dc: Optional[int]
    success: Optional[bool]
    revealed_to: set[str] = field(default_factory=set)

class PrivateInfoManager:
    def create_hidden_roll(
        self,
        pc_id: str,
        roll_type: str,
        result: int,
        dc: Optional[int] = None
    ) -> HiddenRoll:
        """Record a roll that only the rolling player sees."""
        pass

    def get_hidden_roll_message(self, roll: HiddenRoll) -> tuple[str, str]:
        """Get messages for player and others.

        Returns:
            (private_message, public_message)
            private: "You rolled 18 on Perception (DC 15) - Success!"
            public: "[Thorin makes a Perception check]"
        """
        pass

    def reveal_roll(self, roll_id: str, reveal_to: set[str]) -> None:
        """Reveal a hidden roll to additional players."""
        pass
```

### Secret Knowledge System

```python
@dataclass
class SecretKnowledge:
    """Secret information tied to character background or discovery."""
    knowledge_id: str
    pc_id: str
    category: str       # "background", "discovered", "overheard", etc.
    subject: str        # What the secret is about
    content: str        # The actual secret
    source: str         # How they learned it
    relevance_tags: list[str]  # For triggering reveals
    shared_with: set[str] = field(default_factory=set)

class PrivateInfoManager:
    def add_character_secret(
        self,
        pc_id: str,
        subject: str,
        content: str,
        category: str = "background"
    ) -> SecretKnowledge:
        """Add a character secret from their background."""
        pass

    def check_secret_relevance(self, context: str) -> list[SecretKnowledge]:
        """Check if any secrets are relevant to current context."""
        # e.g., PC has secret about NPC they're meeting
        pass

    def prompt_secret_share(self, pc_id: str, knowledge_id: str) -> str:
        """Generate a prompt suggesting the PC might share a secret."""
        # "Thorin, you know something about this symbol..."
        pass
```

### Response Formatting

```python
class PrivateInfoManager:
    def format_response_with_private(
        self,
        public_content: str,
        private_additions: dict[str, str]  # PC ID -> private text
    ) -> dict[str, str]:
        """Format a response with both public and private components.

        Returns dict mapping PC ID to their full view of the response.
        """
        pass

    def interleave_private_info(
        self,
        narration: str,
        relevant_secrets: list[tuple[str, str]]  # (PC ID, secret context)
    ) -> dict[str, str]:
        """Add private annotations to narration for relevant PCs."""
        # e.g., "The merchant smiles warmly"
        #       + [Private: You recognize him as the man who killed your father]
        pass
```

## Dependencies

- Task #58: Multiple PC Tracking
  - Requires PC registry for targeting messages
  - Requires player name mapping

## Effort Estimate

- **Size:** S
- **Estimated Hours:** 4
- **Complexity:** Medium - data management with visibility rules

## Definition of Done

1. Private message system implemented
2. Secret knowledge tracking working
3. Hidden rolls function correctly
4. DM-to-player messaging operational
5. Info sharing between PCs supported
6. Response formatting handles mixed visibility
7. All unit tests passing
8. Integration tests with multi-player scenarios
9. Documentation complete
10. Code reviewed and approved
