---
name: Campaign Wizard Enhancement
status: completed
created: 2026-02-19T23:14:33Z
updated: 2026-02-19T23:18:18Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/176
depends_on: [167, 173]
parallel: false
conflicts_with: [167]
---

# Task: Campaign Wizard Enhancement

## Description

Enhance the campaign creation wizard to include `interaction_mode` (classic/narrated/immersive) and `rules_version` (2014/2024) parameters. Integrate with `configure_claudmaster()` for mid-session mode switching. The two axes (interaction mode and model profile) are orthogonal — any combination is valid.

## Acceptance Criteria

- [ ] `create_campaign()` includes `interaction_mode` parameter: classic, narrated, immersive
- [ ] `create_campaign()` includes `rules_version` parameter (integration with Task #167)
- [ ] Default interaction mode is "classic" (text-only, no TTS/STT dependencies)
- [ ] Mode stored in campaign metadata and persisted
- [ ] Interaction mode switchable mid-session via `configure_claudmaster()`
- [ ] Classic mode works without voice dependencies installed
- [ ] Narrated mode: DM responses delivered as TTS audio + text via WebSocket
- [ ] Immersive mode: Narrated + player STT input from browser
- [ ] Interaction mode and model profile are independent (3 modes × 3 profiles = 9 valid combos)
- [ ] Mode change takes effect immediately (no restart needed)

## Technical Details

### Campaign Manifest Schema Update

In `src/dm20_protocol/storage.py`:

```python
# Campaign manifest gains two new fields
{
    "name": "Dragon's Lair",
    "rules_version": "2024",        # From Task #167
    "interaction_mode": "classic",   # NEW: classic / narrated / immersive
    "model_profile": "balanced",     # Existing
    ...
}
```

### Mode Switching via configure_claudmaster

In `src/dm20_protocol/main.py`:

```python
@mcp_tool
async def configure_claudmaster(**kwargs):
    # Existing: model_profile
    # NEW: interaction_mode
    if "interaction_mode" in kwargs:
        mode = kwargs["interaction_mode"]
        validate_mode(mode)  # classic, narrated, immersive
        if mode in ("narrated", "immersive") and not voice_available():
            return "Voice dependencies not installed. Run: pip install dm20-protocol[voice]"
        storage.campaign.interaction_mode = mode
```

### Mode Behavior Matrix

| Feature | Classic | Narrated | Immersive |
|---------|---------|----------|-----------|
| Text output | Yes | Yes | Yes |
| TTS output | No | Yes | Yes |
| Text input | Yes | Yes | Yes (fallback) |
| STT input | No | No | Yes |
| Voice deps required | No | Yes | Yes |

### Files Affected

- `src/dm20_protocol/main.py` — `create_campaign()` params, `configure_claudmaster()` mode switching
- `src/dm20_protocol/storage.py` — Campaign manifest schema
- `tests/` — Wizard enhancement tests

## Dependencies

- [ ] **Task #167 (Standalone Rules + Version)** — provides `rules_version` in campaign creation
- [ ] **Task #173 (STT + Player UI)** — provides STT infrastructure for immersive mode
- [ ] Voice engine infrastructure (Tasks #171-172) must be available for narrated/immersive modes

## Effort Estimate

- Size: S
- Hours: 4-6
- Parallel: false (depends on Tasks #167 and #173)

## Definition of Done

- [ ] Code implemented
- [ ] Tests written for all 3 interaction modes
- [ ] Mode switching tested mid-session
- [ ] Classic mode verified working without voice deps
- [ ] All 9 mode × profile combinations validated
- [ ] CHANGELOG.md updated
