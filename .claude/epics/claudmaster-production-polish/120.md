---
name: Session Recap Generator
status: open
created: 2026-02-15T01:33:47Z
updated: 2026-02-15T01:39:36Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/120
depends_on: [118]
parallel: true
conflicts_with: [119, 121]
---

# Task: Session Recap Generator

## Description
Implement a "Previously on..." recap system that activates when a player resumes an existing session. The recap reads persisted session data (action history + state snapshot) and generates an atmospheric summary covering location, active quest, recent events, and party status — so the player immediately knows where they left off without losing narrative immersion.

## Acceptance Criteria
- [ ] Resuming a session via `start_claudmaster_session(resume=True)` triggers recap generation
- [ ] Recap covers: current location, active quest/objective, last 3-5 significant events, party HP/status
- [ ] Recap is generated from persisted `action_history.json` and `state_snapshot.json` (not hallucinated)
- [ ] Recap is delivered through the Narrator agent for atmospheric formatting
- [ ] Recap is concise (2-3 paragraphs max) and actionable (player knows what to do next)
- [ ] If no prior session exists, recap is skipped gracefully
- [ ] Works across all model profiles

## Technical Details
- Read from `SessionSerializer`: `load_session()` returns action_history and state_snapshot
- Extract key facts: location (from game state), active quests (from events), recent actions (last 5 from history), character status (from game state)
- Feed extracted facts into Narrator agent with a "recap" prompt template
- Store recap in session metadata so it's not regenerated on subsequent actions
- File locations: `continuity/` module for recap logic, `tools/session_tools.py` for integration
- Reference existing `continuity/` module (auto-save system) for patterns

## Dependencies
- [ ] #118 — Error UX hardening (graceful handling if session data is corrupted/incomplete)

## Effort Estimate
- Size: S
- Hours: 2-3
- Parallel: true (can run alongside #119 if file modifications are coordinated)

## Definition of Done
- [ ] Code implemented
- [ ] Recap accurately reflects persisted session data
- [ ] Tests written for recap generation from mock session data
- [ ] Manual test: save session, resume, verify recap accuracy
