---
name: 20-Turn Stress Test for Session Stability
status: open
created: 2026-02-15T01:33:47Z
updated: 2026-02-15T01:39:36Z
github: https://github.com/Polloinfilzato/dm20-protocol/issues/117
depends_on: [116]
parallel: true
conflicts_with: []
---

# Task: 20-Turn Stress Test for Session Stability

## Description
Create an automated stress test that simulates a 20+ turn Claudmaster session, validating that context management, state consistency, and performance remain stable over extended play. This test catches issues like memory leaks, context drift, growing response times, and state corruption that only appear in sustained sessions.

## Acceptance Criteria
- [ ] Stress test simulates 20+ sequential player actions with varied intent types
- [ ] Validates game state consistency after every turn (no forgotten NPCs, no contradictions)
- [ ] Verifies session `turn_count` and `conversation_history` grow correctly
- [ ] Checks that response generation doesn't degrade over time (no growing latency in mock)
- [ ] Validates context window management keeps conversation_history bounded
- [ ] Test passes reliably with `pytest` using MockLLMClient
- [ ] Test is in `tests/claudmaster/test_stress_session.py`

## Technical Details
- Build on integration test infrastructure from #116
- Create a sequence of 20+ varied actions: exploration, combat, roleplay, questions, system commands
- After each turn: verify session state, check for consistency engine violations
- Track turn-by-turn metrics: conversation_history length, active agents count, response structure
- Simulate a realistic play session: explore → encounter NPC → enter combat → rest → continue
- Use `ClaudmasterSession.get_context()` to verify context stays manageable

## Dependencies
- [ ] #116 — Integration test suite (provides test patterns and infrastructure)

## Effort Estimate
- Size: S
- Hours: 2-3
- Parallel: true (only creates new test files, can run alongside #116)

## Definition of Done
- [ ] Code implemented
- [ ] 20+ turn test passes without errors
- [ ] No state inconsistencies detected
- [ ] Test completes in < 60 seconds
